# Группировка данных

[Task №1](https://stepik.org/lesson/1025978/step/14?unit=1034238)

Напишите запрос, который разбивает режиссеров на группы в зависимости от их страны рождения, определяет средний рейтинг режиссеров каждой группы и отображает полученный результат в виде таблицы из двух полей:
* `country` — название страны
* `avg_rating` — средний рейтинг режиссеров, родившихся в этой стране
Записи в результирующей таблице должны быть расположены в порядке возрастания значения поля `avg_rating`.

<details>
  <summary>Решение</summary>

  ```sql
  SELECT country, 
         AVG(rating) AS avg_rating
  FROM Directors
  GROUP BY country
  ORDER BY avg_rating;
  ```

</details>

---

[Task №2](https://stepik.org/lesson/1025978/step/15?unit=1034238)

Напишите запрос, который разбивает режиссеров на группы в зависимости от их страны рождения, определяет минимальный и максимальный рейтинги среди режиссеров каждой группы и отображает полученный результат в виде таблицы из трех полей:
* `country` — название страны
* `min_rating` — минимальный рейтинг среди режиссеров этой страны
* `max_rating` — максимальный рейтинг среди режиссеров этой страны
Записи в результирующей таблице должны быть расположены в порядке возрастания значения поля `country`.

<details>
  <summary>Решение</summary>

  ```sql
  SELECT country, 
         MIN(rating) AS min_rating,
         MAX(rating) AS max_rating
  FROM Directors
  GROUP BY country
  ORDER BY country;
  ```

</details>

---

[Task №3](https://stepik.org/lesson/1025978/step/16?unit=1034238)

Напишите запрос, который разбивает режиссеров на группы в зависимости от их страны рождения и рейтинга, определяет количество режиссеров в каждой группе и отображает полученный результат в виде таблицы из трех полей:
* `country` — название страны
* `rating` — рейтинг
* `num_of_directors` — количество режиссеров, родившихся в этой стране и имеющих этот рейтинг
Записи в результирующей таблице должны быть расположены в порядке возрастания значения поля `num_of_directors`, при совпадении — в порядке возрастания значения поля `country`, при совпадении — в порядке возрастания значения поля `rating`.

<details>
  <summary>Решение</summary>

  ```sql
  SELECT country, 
         rating,
         COUNT(*) AS num_of_directors
  FROM Directors
  GROUP BY country, rating
  ORDER BY num_of_directors, country, rating;
  ```

</details>

---

[Task №4](https://stepik.org/lesson/1025978/step/17?unit=1034238)

Напишите запрос, который разбивает режиссеров на группы в зависимости от первой буквы в их имени, определяет количество режиссеров в каждой группе и отображает полученный результат в виде таблицы из двух полей:
* `letter` — буква
* `num_of_names` — количество режиссеров, в имени которых эта буква является первой
Записи в результирующей таблице должны быть расположены в порядке возрастания значения поля `num_of_names`, при совпадении — в порядке возрастания значения поля `letter`.

<details>
  <summary>Решение</summary>

  ```sql
  SELECT LEFT(name, 1) AS letter, 
         COUNT(*) AS num_of_names
  FROM Directors
  GROUP BY LEFT(name, 1)
  ORDER BY num_of_names, letter;
  ```

</details>

---

[Task №5](https://stepik.org/lesson/1025978/step/18?unit=1034238)

Напишите запрос, который разбивает режиссеров на группы в зависимости от доменной части в адресе их электронной почты, перечисляет локальные части адресов электронных почт режиссеров каждой группы и отображает полученный результат в виде таблицы из двух полей:
* `domain` — доменная часть адреса электронной почты
* `users` — локальные имена адресов электронных почт режиссеров с этой доменной частью, перечисленные через запятую и пробел, а также расположенные в лексикографическом порядке
Записи в результирующей таблице должны быть расположены в порядке возрастания значения поля `domain`.

<details>
  <summary>Решение</summary>

  ```sql
  SELECT SUBSTRING_INDEX(email, '@', -1) AS domain,
         GROUP_CONCAT(SUBSTRING_INDEX(email, '@', 1) ORDER BY SUBSTRING_INDEX(email, '@', 1) SEPARATOR ', ') AS users
  FROM Directors
  GROUP BY SUBSTRING_INDEX(email, '@', -1)
  ORDER BY domain;
  ```

</details>

---

[Task №6](https://stepik.org/lesson/1025978/step/19?unit=1034238)

Напишите запрос, который разбивает режиссеров на группы в зависимости от их страны рождения, определяет средний рейтинг режиссеров каждой группы, учитывая только значения больше `10` и меньше `90`, и отображает полученный результат в виде таблицы из двух полей:
* `country` — название страны
* `avg_rating` — средний рейтинг режиссеров, родившихся в этой стране
Записи в результирующей таблице должны быть расположены в порядке возрастания значения поля `avg_rating`.

<details>
  <summary>Решение</summary>

  ```sql
  SELECT country,
         AVG(rating) AS avg_rating
  FROM Directors
  WHERE rating BETWEEN 11 and 89
  GROUP BY country
  ORDER BY avg_rating;
  ```

</details>

---

[Task №7](https://stepik.org/lesson/1025978/step/20?unit=1034238)

Напишите запрос, который разбивает режиссеров на группы в зависимости от их страны рождения, определяет средний рейтинг режиссеров каждой группы, учитывая только значения больше `30` и меньше `70`, и отображает полученный результат в виде таблицы из двух полей:
* `country` — название страны
* `avg_rating` — средний рейтинг режиссеров, родившихся в этой стране
При этом в результирующую таблицу должна быть добавлена информация только о тех группах режиссеров, средний рейтинг которых меньше `60`.
Записи в результирующей таблице должны быть расположены в порядке возрастания значения поля `avg_rating`.

<details>
  <summary>Решение</summary>

  ```sql
  SELECT country,
         AVG(rating) AS avg_rating
  FROM Directors
  WHERE rating BETWEEN 31 and 69
  GROUP BY country 
  HAVING avg_rating < 60
  ORDER BY avg_rating;
  ```

</details>

---

[Task №8](https://stepik.org/lesson/1025978/step/21?unit=1034238)

Напишите запрос, который разбивает режиссеров на группы в зависимости от квартала, в котором они родились, перечисляет имена и фамилии режиссеров каждой группы и отображает полученный результат в виде таблицы из двух полей:
* `quarter` — квартал
* `directors` — имена и фамилии режиссеров, которые родились в этом квартале, перечисленные через запятую и пробел, а также расположенные в лексикографическом порядке
При этом в результирующую таблицу должна быть добавлена информация только о тех группах режиссеров, количество которых больше одного.

<details>
  <summary>Решение</summary>

  ```sql
  SELECT QUARTER(birth_date) AS quarter,
         GROUP_CONCAT(CONCAT_WS(' ', name, surname) ORDER BY name SEPARATOR ', ') AS directors
  FROM Directors
  GROUP BY quarter 
  HAVING COUNT(*) > 1;
  ```

</details>
